<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Breakout!</title>
		<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
		<!-- http://billmill.org/static/canvastutorial/index.html -->
		<!-- https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API -->
		<style type="text/css">
			canvas {
				border: 1px solid black;
			}
		</style>
	</head>
	<body>
		<canvas id="canvas" width="800" height="600"></canvas>

		<script type="text/javascript">
			var ctx, ball, paddle, WIDTH, HEIGHT, intervalId;
			ball = {
				"x": 0,
				"y": 0,
				"xVelocity": 1,
				"yVelocity": 1,
				'radius': 20
			};

			paddle = {
				"x": 550,
				"y": 580,
				'width': 100,
				'height': 10,
				'xVelocity': 0
			};

			function init() {
 				ctx = $('#canvas')[0].getContext("2d");
 				WIDTH = $('#canvas').width();
 				HEIGHT = $('#canvas').height();

				paddle.y = HEIGHT - paddle.height;

				$('body').keydown(function(evt) {
					//right
					if(evt.which == 39) {
						paddle.xVelocity = 4;
					}else if(evt.which == 37) {
						paddle.xVelocity = -4;
					}
				});

				$('body').keyup(function() {
					paddle.xVelocity = 0;
				});

 				return setInterval(draw, 1);
			}

			function drawCircle(x, y, r, color) {
				if(color) {
					ctx.fillStyle = color;
				}
				
				ctx.beginPath();
				ctx.arc(x, y, r, 0, Math.PI*2, true);
				ctx.closePath();

				ctx.fill();
			}


			function drawRect(x, y, w, h, color) {
				if(color) {
					ctx.fillStyle = color;
				}
				
				ctx.beginPath();
				ctx.rect(x, y, w, h);
				ctx.closePath();

				ctx.fill();
			}

			function clear() {
				ctx.clearRect(0,0, WIDTH, HEIGHT);
			}

			function draw() {
				clear();
				drawCircle(ball.x, ball.y, ball.radius, 'blue');
				drawRect(paddle.x, paddle.y, paddle.width, paddle.height, 'orange');

				ball.x += ball.xVelocity;
				ball.y += ball.yVelocity;

				paddle.x += paddle.xVelocity;

				if((ball.x + ball.radius + ball.xVelocity)>WIDTH) {
					ball['xVelocity'] = Math.abs(ball['xVelocity']) * -1;
				}

				if(ball.x-ball.radius<0) {
					ball['xVelocity'] = Math.abs(ball['xVelocity']);
				}

				//paddle
				if(ball.y-ball.radius>paddle.y) {
					//game over
					clearInterval(intervalId);
				}else if(ball.y+ball.radius+ball.yVelocity>paddle.y) {
					if(ball.x > paddle.x && ball.x < paddle.x + paddle.width) {
						ball['yVelocity'] = Math.abs(ball['yVelocity']) * -1;
					}
				}

				if(ball.y-ball.radius<0) {
					ball['yVelocity'] = Math.abs(ball['yVelocity']);
				}
			}


			intervalId = init();
		</script>
	</body>
</html>